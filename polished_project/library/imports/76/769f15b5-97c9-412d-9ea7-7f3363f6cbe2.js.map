{"version":3,"sources":["..\\..\\..\\..\\assets\\scripts/assets\\scripts\\GameTools.js"],"names":["GameConfig","require","GameTools","love2048FrameCache","numberLabelAtlas","playSimpleAudioEngine","engineType","IS_GAME_MUSIC","cc","audioEngine","play","url","raw","getItemByLocalStorage","key","value","values","sys","localStorage","getItem","undefined","setItem","Number","setItemByLocalStorage","toastMessage","toastType","loader","loadRes","err","prefab","node","instantiate","getComponent","Component","director","getScene","getChildByName","addChild","showSpotAds","type","autoShowSpotAds","times","showAddInteardlView","showGameHelp","sharePicture","pictureName","titleStr","CC_WECHATGAME","window","wx","shareAppMessage","title","query","MAIN_MENU_NUM","imageUrl","canvas","toTempFilePathSync","destWidth","destHeight","success","res","shareTickets","length","postMessage","messageType","shareTicket","saveImageToLocal","log","authorization","getSetting","authSetting","authorize","scope","console","loadScene","fail","showModal","content","width","winSize","height","saveImageToPhotosAlbum","filePath","data","errMsg","getGameIntegral","setGameIntegral","intrgral","commentGame","openCustomerServiceConversation","checkFirstLoginGame","loginDate","Math","floor","Date","getTime","getRankData","children","removeRankData","submitScore","score","module","exports"],"mappings":"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","file":"GameTools.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["var GameConfig = require(\"GameConfig\");\nvar GameTools = {\n    love2048FrameCache: null,\n    numberLabelAtlas: null,\n    playSimpleAudioEngine: function (engineType) {\n        if (GameConfig.IS_GAME_MUSIC) {\n            switch (engineType) {\n                case 0:\n                    cc.audioEngine.play(cc.url.raw('resources/audios/sfx_button.wav'), false, 0.5);\n                    break;\n                case 1:\n                    cc.audioEngine.play(cc.url.raw('resources/audios/sfx_highscore.wav'), false, 0.5);\n                    break;\n                case 2:\n                    cc.audioEngine.play(cc.url.raw(\"resources/audios/sfx_player_die.wav\"), false, 0.5);\n                    break;\n                case 3:\n                    cc.audioEngine.play(cc.url.raw(\"resources/audios/sfx_player_jump.wav\"), false, 0.5);\n                    break;\n                case 4:\n                    cc.audioEngine.play(cc.url.raw(\"resources/audios/sfx_score.wav\"), false, 0.5);\n                    break;\n                default:\n                    break;\n            }\n        }\n    },\n    getItemByLocalStorage: function (key, value) {\n        let values = cc.sys.localStorage.getItem(key);\n        if (values === undefined || values === null || values === '') {\n            cc.sys.localStorage.setItem(key, value);\n            return value;\n        }\n        if (typeof value === 'boolean') {\n            if (typeof values === 'boolean') {\n                return values;\n            }\n            return \"true\" == values;\n        } else if (typeof value === 'number') {\n            return Number(values);\n        }\n        return values;\n    },\n    setItemByLocalStorage: function (key, value) {\n        cc.sys.localStorage.setItem(key, value);\n    },\n    toastMessage(toastType) {\n        cc.loader.loadRes(\"panel/ShowMessage\", (err, prefab) => {\n            if (!err) {\n                var node = cc.instantiate(prefab);\n                node.getComponent(cc.Component).toastType = toastType;\n                cc.director.getScene().getChildByName('Canvas').addChild(node);\n            }\n        });\n    }\n    , showSpotAds(type) { //显示插屏广告\n    }\n    , autoShowSpotAds(times) {\n    }\n    , showAddInteardlView() { //显示获取积分窗口\n    }\n    , showGameHelp() //显示游戏帮助\n    {\n    }\n    , sharePicture(pictureName) {\n        let titleStr = '点进去玩一下就好了。';\n        if (\"shareTicket\" == pictureName) {\n            titleStr = \"看看你在群里排第几？点进去玩一下就好了。\";\n        } else if (pictureName != undefined && pictureName != null) {\n            // titleStr = \"我得了\" + pictureName + \"分,\" + titleStr;\n        }\n        if (CC_WECHATGAME) {\n            window.wx.shareAppMessage({\n                title: titleStr,\n                query: \"x=\" + GameConfig.MAIN_MENU_NUM,\n                imageUrl: canvas.toTempFilePathSync({\n                    destWidth: 500,\n                    destHeight: 400\n                }),\n                success: (res) => {\n                    if (res.shareTickets != undefined && res.shareTickets.length > 0) {\n                        if (\"shareTicket\" == pictureName) {\n                            window.wx.postMessage({\n                                messageType: 5,\n                                MAIN_MENU_NUM: GameConfig.MAIN_MENU_NUM,\n                                shareTicket: res.shareTickets[0]\n                            });\n                        }\n                    }\n                }\n            });\n            this.saveImageToLocal();\n        } else {\n            this.toastMessage(1);\n            cc.log(\"执行了截图\" + titleStr);\n        }\n    },\n    //授权\n    authorization:function(){\n        window.wx.getSetting({\n            success(res) {\n                if (!res.authSetting['scope.writePhotosAlbum']) {\n                    //访问相册授权\n                    wx.authorize({\n                        scope:'scope.writePhotosAlbum',\n                        success() {\n                            console.log('授权成功');\n                            cc.director.loadScene('load');\n                        },\n                        fail(){\n                            console.log('授权失败');\n                            window.wx.showModal({\n                                content: '您点击了拒绝授权,将无法保存图片到相册,想重新授权，请点击右上角菜单->关于（小程序名字）->右上角菜单->设置。',\n                            })\n                        }\n                    })\n                }else {\n                    cc.director.loadScene('load');\n                }\n            }\n        });\n    },\n    saveImageToLocal:function(){\n        //保存到手机相册\n        let width  = cc.winSize.width;\n        let height  = cc.winSize.height;\n        window.wx.saveImageToPhotosAlbum({\n            filePath: canvas.toTempFilePathSync({\n                destWidth: width,\n                destHeight: height\n            }),\n            success:function (data) {\n                console.log(data);\n            },\n            fail:function (err) {\n                console.log(err);\n                if (err.errMsg === \"saveImageToPhotosAlbum:fail auth deny\") {\n                    console.log(\"用户一开始拒绝了，我们想再次发起授权\");\n                    console.log('打开设置窗口');\n                }\n            }\n        })\n    },\n    getGameIntegral() { //获取积分\n        return this.getItemByLocalStorage(\"GameIntegral\", 0);\n    },\n    setGameIntegral(intrgral) { // 设置积分\n        cc.sys.localStorage.setItem(\"GameIntegral\", intrgral);\n        // if (GameConfig.GameScene != undefined || GameConfig.GameScene != null) {\n        //     GameConfig.GameScene.gameIntegral.string = intrgral;\n        // }\n    }\n    , commentGame() { //评论\n        if (CC_WECHATGAME) {\n            window.wx.openCustomerServiceConversation({});\n        } else {\n            this.toastMessage(1);\n            cc.log(\"执行了评论\")\n        }\n    }\n    , checkFirstLoginGame() { //检查是否首次登录\n        let loginDate = Math.floor((new Date().getTime() - new Date(2018, 3, 18, 0, 0, 0, 0).getTime()) / (1000 * 60 * 60 * 24));\n        if (loginDate > this.getItemByLocalStorage(\"FirstEnterGameDate\", 0)) {\n            cc.sys.localStorage.setItem(\"FirstEnterGameDate\", loginDate);\n            this.setGameIntegral(this.getGameIntegral() + 100);\n            this.toastMessage(9)\n        }\n    }\n\n    , getRankData(shareTicket) { //获取排行榜\n\n        cc.loader.loadRes(\"panel/RankingListView\", (err, prefab) => {\n            if (!err) {\n                cc.log(\"进到此处了吗，，666，，，，\");\n                var node = cc.instantiate(prefab);\n                if (shareTicket != undefined) {\n                    node.getComponent(cc.Component).shareTicket = shareTicket;\n                }\n                cc.director.getScene().children[0].addChild(node);\n            }\n        });\n    }\n    , removeRankData() {//移除排行榜数据\n        if (CC_WECHATGAME) {\n            window.wx.postMessage({\n                messageType: 0,\n            });\n        } else {\n            cc.log(\"移除排行榜数据。\");\n        }\n    }\n    , submitScore(score) { //提交得分\n        if (CC_WECHATGAME) {\n            window.wx.postMessage({\n                messageType: 3,\n                MAIN_MENU_NUM: GameConfig.MAIN_MENU_NUM,\n                score: score,\n            });\n        } else {\n            cc.log(\"提交得分:\" + GameConfig.MAIN_MENU_NUM + \" : \" + score)\n        }\n    }\n};\n\nmodule.exports = GameTools;"]}